/**
 * Sinon.JS 1.1.0-pre, 2011/03/13
 *
 * @author Christian Johansen (christian@cjohansen.no)
 *
 * (The BSD License)
 *
 * Copyright (c) 2010-2011, Christian Johansen, christian@cjohansen.no
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright notice,
 *       this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright notice,
 *       this list of conditions and the following disclaimer in the documentation
 *       and/or other materials provided with the distribution.
 *     * Neither the name of Christian Johansen nor the names of his contributors
 *       may be used to endorse or promote products derived from this software
 *       without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
"use strict";var sinon=function(){function b(b){var c=!1;try{b.appendChild(a),c=a.parentNode==b}catch(d){return!1}finally{try{b.removeChild(a)}catch(d){}}return c}function c(c){return a&&c&&c.nodeType===1&&b(c)}var a=typeof document!="undefined"&&document.createElement("div");return{wrapMethod:function d(a,b,c){if(!a)throw new TypeError("Should wrap property of object");if(typeof c!="function")throw new TypeError("Method wrapper should be function");var d=a[b],e=typeof d;if(e!="function")throw new TypeError("Attempted to wrap "+e+" property "+b+" as function");if(d.restore&&d.restore.sinon)throw new TypeError("Attempted to wrap "+b+" which is already wrapped");if(d.calledBefore){var f=d.returns?"stubbed":"spied on";throw new TypeError("Attempted to wrap "+b+" which is already "+f)}return a[b]=c,c.displayName=b,c.restore=function(){a[b]=d},c.restore.sinon=!0,c},extend:function(a){for(var b=1,c=arguments.length;b<c;b+=1)for(var d in arguments[b])arguments[b].hasOwnProperty(d)&&(a[d]=arguments[b][d]);return a},create:function(a){if(Object.create)return Object.create(a);var b=function(){};return b.prototype=a,new b},deepEqual:function g(a,b){if(typeof a!="object"||typeof b!="object")return a===b;if(c(a)||c(b))return a===b;if(a===b)return!0;if(Object.prototype.toString.call(a)=="[object Array]"){if(a.length!==b.length)return!1;for(var d=0,e=a.length;d<e;d+=1)if(!g(a[d],b[d]))return!1;return!0}var f,h=0,i=0;for(f in a){h+=1;if(!g(a[f],b[f]))return!1}for(f in b)i+=1;return h!=i?!1:!0},keys:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b.sort()},functionName:function(a){var b=a.displayName||a.name;if(!b){var c=a.toString().match(/function ([^\s\(]+)/);b=c&&c[1]}return b},functionToString:function(){if(this.getCall&&this.callCount){var a,b,c=this.callCount;while(c--){a=this.getCall(c).thisValue;for(b in a)if(a[b]===this)return b}}return this.displayName||"sinon fake"},getConfig:function(a){var b={};a=a||{};var c=sinon.defaultConfig;for(var d in c)c.hasOwnProperty(d)&&(b[d]=a.hasOwnProperty(d)?a[d]:c[d]);return b},defaultConfig:{injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0}}}();typeof module=="object"&&typeof require=="function"&&(module.exports=sinon,module.exports.spy=require("./sinon/spy"),module.exports.stub=require("./sinon/stub"),module.exports.mock=require("./sinon/mock"),module.exports.collection=require("./sinon/collection"),module.exports.assert=require("./sinon/assert"),module.exports.sandbox=require("./sinon/sandbox"),module.exports.test=require("./sinon/test"),module.exports.testCase=require("./sinon/test_case"),module.exports.assert=require("./sinon/assert")),function(a){function e(b,c){if(!c&&typeof b=="function")return e.create(b);if(!b||!c)return e.create(function(){});var d=b[c];return a.wrapMethod(b,c,e.create(d))}var b=typeof module=="object"&&typeof require=="function",c,d=0;!a&&b&&(a=require("sinon"));if(!a)return;a.extend(e,function(){function f(a,b,c,d){a[b]=function(){if(!this.called)return!1;var a,e=0;for(var f=0,g=this.callCount;f<g;f+=1){a=this.getCall(f);if(a[d||b].apply(a,arguments)){e+=1;if(c)return!0}}return e===this.callCount}}var b=Array.prototype.slice,g={reset:function(){this.called=!1,this.calledOnce=!1,this.calledTwice=!1,this.calledThrice=!1,this.callCount=0,this.args=[],this.returnValues=[],this.thisValues=[],this.exceptions=[],this.callIds=[]},create:function(c){function f(){return f.invoke(c,this,b.call(arguments))}var d;return typeof c!="function"?c=function(){}:d=a.functionName(c),a.extend(f,e),delete f.create,a.extend(f,c),f.reset(),f.prototype=c.prototype,f.displayName=d||"spy",f.toString=a.functionToString,f},invoke:function(a,b,c){var e,f;this.called=!0,this.callCount+=1,this.calledOnce=this.callCount==1,this.calledTwice=this.callCount==2,this.calledThrice=this.callCount==3,this.thisValues.push(b),this.args.push(c),this.callIds.push(d++);try{f=a.apply(b,c)}catch(g){throw this.returnValues.push(undefined),e=g,g}finally{this.exceptions.push(e)}return this.returnValues.push(f),f},getCall:function(a){return a<0||a>=this.callCount?null:c.create(this.thisValues[a],this.args[a],this.returnValues[a],this.exceptions[a],this.callIds[a])},calledBefore:function(a){return this.called?a.called?this.callIds[0]<a.callIds[0]:!0:!1},calledAfter:function(a){return!this.called||!a.called?!1:this.callIds[this.callCount-1]>a.callIds[a.callCount-1]}};return f(g,"calledOn",!0),f(g,"alwaysCalledOn",!1,"calledOn"),f(g,"calledWith",!0),f(g,"alwaysCalledWith",!1,"calledWith"),f(g,"calledWithExactly",!0),f(g,"alwaysCalledWithExactly",!1,"calledWithExactly"),f(g,"threw",!0),f(g,"alwaysThrew",!1,"threw"),f(g,"returned",!0),f(g,"alwaysReturned",!1,"returned"),g}()),c=function(){return{create:function b(b,e,f,g,h){var i=a.create(c);return delete i.create,i.thisValue=b,i.args=e,i.returnValue=f,i.exception=g,i.callId=typeof h=="number"&&h||d++,i},calledOn:function(a){return this.thisValue===a},calledWith:function(){for(var b=0,c=arguments.length;b<c;b+=1)if(!a.deepEqual(arguments[b],this.args[b]))return!1;return!0},calledWithExactly:function(){return arguments.length==this.args.length&&this.calledWith.apply(this,arguments)},returned:function(a){return this.returnValue===a},threw:function(a){return typeof a=="undefined"||!this.exception?!!this.exception:typeof a=="string"?this.exception.name==a:this.exception===a},calledBefore:function(a){return this.callId<a.callId},calledAfter:function(a){return this.callId>a.callId}}}(),b?module.exports=e:(a.spy=e,a.spyCall=c)}(typeof sinon=="object"&&sinon||null),function(a){function c(b,d,e){if(!e||typeof e=="function"){var f;e?f=a.spy&&a.spy.create?a.spy.create(e):e:f=c.create();if(!b&&!d)return a.stub.create();if(!d&&!!b&&typeof b=="object"){for(var g in b)b.hasOwnProperty(g)&&typeof b[g]=="function"&&c(b,g);return b}return a.wrapMethod(b,d,f)}throw new TypeError("Custom stub should be function")}function d(a,b){if(a.callArgAt<0){for(var c=0,d=b.length;c<d;++c){if(!a.callArgProp&&typeof b[c]=="function")return b[c];if(a.callArgProp&&b[c]&&typeof b[c][a.callArgProp]=="function")return b[c][a.callArgProp]}return null}return b[a.callArgAt]}function f(b,c,d){if(b.callArgAt<0){var f;return b.callArgProp?f=a.functionName(b)+" expected to yield to '"+b.callArgProp+"', but no object with such a property was passed.":f=a.functionName(b)+" expected to yield, but no callback was passed.",d.length>0&&(f+=" Received ["+e.call(d,", ")+"]"),f}return"argument at index "+b.callArgAt+" is not a function: "+c}function g(a,b){if(typeof a.callArgAt=="number"){var c=d(a,b);if(typeof c!="function")throw new TypeError(f(a,c,b));c.apply(null,a.callbackArguments)}}var b=typeof module=="object"&&typeof require=="function";!a&&b&&(a=require("sinon"));if(!a)return;var e=Array.prototype.join;a.extend(c,function(){function d(a,b){return typeof a=="string"?(this.exception=new Error(b),this.exception.name=a):a?this.exception=a:this.exception=new Error("Error"),this}var b=Array.prototype.slice;return{create:function(){var b=function(){if(b.exception)throw b.exception;return g(b,arguments),b.returnValue};return a.spy&&(b=a.spy.create(b)),a.extend(b,c),b.displayName="stub",b.toString=a.functionToString,b},returns:function(a){return this.returnValue=a,this},"throws":d,throwsException:d,callsArg:function(a){if(typeof a!="number")throw new TypeError("argument index is not number");return this.callArgAt=a,this.callbackArguments=[],this},callsArgWith:function(a){if(typeof a!="number")throw new TypeError("argument index is not number");return this.callArgAt=a,this.callbackArguments=b.call(arguments,1),this},yields:function(){return this.callArgAt=-1,this.callbackArguments=b.call(arguments,0),this},yieldsTo:function(a){return this.callArgAt=-1,this.callArgProp=a,this.callbackArguments=b.call(arguments,1),this}}}()),b?module.exports=c:a.stub=c}(typeof sinon=="object"&&sinon||null),function(a){function c(b){return b?c.create(b):a.expectation.create("Anonymous mock")}function d(a){var b=new Error(a);throw b.name="ExpectationError",b}var b=typeof module=="object"&&typeof require=="function";!a&&b&&(a=require("sinon"));if(!a)return;a.mock=c,a.extend(c,function(){function b(a,b){if(!a)return;for(var c=0,d=a.length;c<d;c+=1)b(a[c])}return{create:function d(b){if(!b)throw new TypeError("object is null");var d=a.extend({},c);return d.object=b,delete d.create,d},expects:function(b){if(!b)throw new TypeError("method is falsy");this.expectations||(this.expectations={},this.proxies=[]);if(!this.expectations[b]){this.expectations[b]=[];var c=this;a.wrapMethod(this.object,b,function(){return c.invokeMethod(b,this,arguments)}),this.proxies.push(b)}var d=a.expectation.create(b);return this.expectations[b].push(d),d},restore:function(){var a=this.object;b(this.proxies,function(b){typeof a[b].restore=="function"&&a[b].restore()})},verify:function(){var a=this.expectations||{},c;try{b(this.proxies,function(c){b(a[c],function(a){a.verify()})})}catch(d){c=d}this.restore();if(c)throw c;return!0},invokeMethod:function(a,b,c){var d=this.expectations&&this.expectations[a],e=d&&d.length||0;for(var f=0;f<e;f+=1)if(!d[f].met())return d[f].apply(b,c);return d[e-1].apply(b,c)}}}()),a.expectation=function(){function e(a){return a==1?"once":a==2?"twice":a==3?"thrice":a+" times"}function f(a){var b=typeof a.minCalls=="number";return!b||a.callCount>=a.minCalls}function g(a){return typeof a.maxCalls!="number"?!1:a.callCount==a.maxCalls}var b=Array.prototype.slice,c=a.spy.invoke;return{minCalls:1,maxCalls:1,create:function(b){var c=a.extend(a.stub.create(),a.expectation);return delete c.create,c.method=b,c},invoke:function(a,b,d){return this.verifyCallAllowed(b,d),c.apply(this,arguments)},atLeast:function(a){if(typeof a!="number")throw new TypeError("'"+a+"' is not number");return this.limitsSet||(this.maxCalls=null,this.limitsSet=!0),this.minCalls=a,this},atMost:function(a){if(typeof a!="number")throw new TypeError("'"+a+"' is not number");return this.limitsSet||(this.minCalls=null,this.limitsSet=!0),this.maxCalls=a,this},never:function(){return this.exactly(0)},once:function(){return this.exactly(1)},twice:function(){return this.exactly(2)},thrice:function(){return this.exactly(3)},exactly:function(a){if(typeof a!="number")throw new TypeError("'"+a+"' is not a number");return this.atLeast(a),this.atMost(a)},met:function(){return!this.failed&&f(this)},verifyCallAllowed:function(b,c){g(this)&&(this.failed=!0,d(this.method+" already called "+e(this.maxCalls))),"expectedThis"in this&&this.expectedThis!==b&&d(this.method+" called with "+b+" as thisValue, expected "+this.expectedThis);if(!("expectedArguments"in this))return;(!c||c.length===0)&&d(this.method+" received no arguments, expected "+this.expectedArguments.join()),c.length<this.expectedArguments.length&&d(this.method+" received too few arguments ("+c.join()+"), expected "+this.expectedArguments.join()),this.expectsExactArgCount&&c.length!=this.expectedArguments.length&&d(this.method+" received too many arguments ("+c.join()+"), expected "+this.expectedArguments.join());for(var f=0,h=this.expectedArguments.length;f<h;f+=1)a.deepEqual(this.expectedArguments[f],c[f])||d(this.method+" received wrong arguments ("+c.join()+"), expected "+this.expectedArguments.join())},withArgs:function(){return this.expectedArguments=b.call(arguments),this},withExactArgs:function(){return this.withArgs.apply(this,arguments),this.expectsExactArgCount=!0,this},on:function(a){return this.expectedThis=a,this},verify:function(){return this.met()||d(this.method+" expected to be called "+e(this.minCalls)+", but was called "+e(this.callCount)),!0}}}(),b?module.exports=c:a.mock=c}(typeof sinon=="object"&&sinon||null),function(a){function c(a){return a.fakes||(a.fakes=[]),a.fakes}function d(a,b){var d=c(a);for(var e=0,f=d.length;e<f;e+=1)typeof d[e][b]=="function"&&d[e][b]()}var b=typeof module=="object"&&typeof require=="function";!a&&b&&(a=require("sinon"));if(!a)return;var e={verify:function(){d(this,"verify")},restore:function(){d(this,"restore")},verifyAndRestore:function(){var a;try{this.verify()}catch(b){a=b}this.restore();if(a)throw a},add:function(a){return c(this).push(a),a},spy:function(){return this.add(a.spy.apply(a,arguments))},stub:function(){return this.add(a.stub.apply(a,arguments))},mock:function(){return this.add(a.mock.apply(a,arguments))},inject:function(a){var b=this;return a.spy=function(){return b.spy.apply(b,arguments)},a.stub=function(){return b.stub.apply(b,arguments)},a.mock=function(){return b.mock.apply(b,arguments)},a}};b?module.exports=e:a.collection=e}(typeof sinon=="object"&&sinon||null);if(typeof sinon=="undefined")var sinon={};sinon.clock=function(){function addTimer(a,b){if(a.length===0)throw new Error("Function requires at least 1 parameter");var c=id++,d=a[1]||0;return this.timeouts||(this.timeouts={}),this.timeouts[c]={id:c,func:a[0],callAt:this.now+d},b===!0&&(this.timeouts[c].interval=d),c}function parseTime(a){if(!a)return 0;var b=a.split(":"),c=b.length,d=c,e=0,f;if(c>3||!/^(\d\d:){0,2}\d\d?$/.test(a))throw new Error("tick only understands numbers and 'h:m:s'");while(d--){f=parseInt(b[d],10);if(f>=60)throw new Error("Invalid time "+a);e+=f*Math.pow(60,c-d-1)}return e*1e3}function createObject(a){var b;if(Object.create)b=Object.create(a);else{var c=function(){};c.prototype=a,b=new c}return b.Date.clock=b,b}var id=0;return{now:0,create:function(a){var b=createObject(this);return typeof a=="number"&&(this.now=a),b},setTimeout:function(a,b){return addTimer.call(this,arguments,!1)},clearTimeout:function(a){this.timeouts||(this.timeouts=[]),delete this.timeouts[a]},setInterval:function(a,b){return addTimer.call(this,arguments,!0)},clearInterval:function(a){this.clearTimeout(a)},tick:function(a){a=typeof a=="number"?a:parseTime(a);var b=this.now,c=this.now+a,d=this.now,e=this.firstTimerInRange(b,c);while(e&&b<=c)this.timeouts[e.id]&&(b=this.now=e.callAt,this.callTimer(e)),e=this.firstTimerInRange(d,c),d=b;this.now=c},firstTimerInRange:function(a,b){var c,d,e;for(var f in this.timeouts)if(this.timeouts.hasOwnProperty(f)){if(this.timeouts[f].callAt<a||this.timeouts[f].callAt>b)continue;if(!d||this.timeouts[f].callAt<d)e=this.timeouts[f],d=this.timeouts[f].callAt,c={func:this.timeouts[f].func,callAt:this.timeouts[f].callAt,interval:this.timeouts[f].interval,id:this.timeouts[f].id}}return c||null},callTimer:function(timer){try{typeof timer.func=="function"?timer.func.call(null):eval(timer.func)}catch(e){}if(!this.timeouts[timer.id])return;typeof timer.interval=="number"?this.timeouts[timer.id].callAt+=timer.interval:delete this.timeouts[timer.id]},reset:function(){this.timeouts={}},Date:function(){function b(c,d,e,f,g,h,i){switch(arguments.length){case 0:return new a(b.clock.now);case 1:return new a(c);case 2:return new a(c,d);case 3:return new a(c,d,e);case 4:return new a(c,d,e,f);case 5:return new a(c,d,e,f,g);case 6:return new a(c,d,e,f,g,h);default:return new a(c,d,e,f,g,h,i)}}var a=Date;return a.now&&(b.now=function(){return b.clock.now}),a.toSource&&(b.toSource=function(){return a.toSource()}),b.toString=function(){return a.toString()},b.prototype=a.prototype,b.parse=a.parse,b.UTC=a.UTC,b}()}}(),sinon.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval,Date:Date},sinon.useFakeTimers=function(a){function c(){var b;for(var c=0,d=this.methods.length;c<d;c++)b=this.methods[c],a[b]=this["_"+b]}function d(b,c){c["_"+b]=a[b],a[b]=function(){return c[b].apply(c,arguments)};for(var d in c[b])c[b].hasOwnProperty(d)&&(a[b][d]=c[b][d]);a[b].clock=c}var b=["Date","setTimeout","setInterval","clearTimeout","clearInterval"];return function e(a){var e=sinon.clock.create(a);e.restore=c,e.methods=Array.prototype.slice.call(arguments,typeof a=="number"?1:0),e.methods.length===0&&(e.methods=b);for(var f=0,g=e.methods.length;f<g;f++)d(e.methods[f],e);return e}}(typeof global!="undefined"?global:this),typeof module=="object"&&typeof require=="function"&&(module.exports=sinon),typeof sinon=="undefined"&&(this.sinon={}),sinon.xhr={XMLHttpRequest:this.XMLHttpRequest},sinon.FakeXMLHttpRequest=function(){function b(){this.readyState=b.UNSENT,this.requestHeaders={},this.requestBody=null,this.status=0,this.statusText="",typeof b.onCreate=="function"&&b.onCreate(this)}function c(a){if(a.readyState!==b.OPENED)throw new Error("INVALID_STATE_ERR");if(a.sendFlag)throw new Error("INVALID_STATE_ERR")}var a={"Accept-Charset":!0,"Accept-Encoding":!0,Connection:!0,"Content-Length":!0,Cookie:!0,Cookie2:!0,"Content-Transfer-Encoding":!0,Date:!0,Expect:!0,Host:!0,"Keep-Alive":!0,Referer:!0,TE:!0,Trailer:!0,"Transfer-Encoding":!0,Upgrade:!0,"User-Agent":!0,Via:!0};return sinon.extend(b.prototype,{async:!0,open:function d(a,c,d,e,f){this.method=a,this.url=c,this.async=typeof d=="boolean"?d:!0,this.username=e,this.password=f,this.responseText=null,this.responseXML=null,this.requestHeaders={},this.sendFlag=!1,this.readyStateChange(b.OPENED)},readyStateChange:function(a){this.readyState=a,typeof this.onreadystatechange=="function"&&this.onreadystatechange()},setRequestHeader:function(b,d){c(this);if(a[b]||/^(Sec-|Proxy-)/.test(b))throw new Error('Refused to set unsafe header "'+b+'"');this.requestHeaders[b]?this.requestHeaders[b]+=","+d:this.requestHeaders[b]=d},setResponseHeaders:function(a){this.responseHeaders={};for(var c in a)a.hasOwnProperty(c)&&(this.responseHeaders[c]=a[c]);this.async&&this.readyStateChange(b.HEADERS_RECEIVED)},send:function(a){c(this);if(!/^(get|head)$/i.test(this.method)){if(this.requestHeaders["Content-Type"]){var d=this.requestHeaders["Content-Type"].split(";");this.requestHeaders["Content-Type"]=d[0]+";charset=utf-8"}else this.requestHeaders["Content-Type"]="text/plain;charset=utf-8";this.requestBody=a}this.errorFlag=!1,this.sendFlag=this.async,this.readyStateChange(b.OPENED),typeof this.onSend=="function"&&this.onSend(this)},abort:function(){this.aborted=!0,this.responseText=null,this.errorFlag=!0,this.requestHeaders={},this.readyState>sinon.FakeXMLHttpRequest.OPENED&&(this.readyStateChange(sinon.FakeXMLHttpRequest.DONE),this.sendFlag=!1),this.readyState=sinon.FakeXMLHttpRequest.UNSENT},getResponseHeader:function(a){if(this.readyState<b.HEADERS_RECEIVED)return null;if(/^Set-Cookie2?$/i.test(a))return null;a=a.toLowerCase();for(var c in this.responseHeaders)if(c.toLowerCase()==a)return this.responseHeaders[c];return null},getAllResponseHeaders:function(){if(this.readyState<b.HEADERS_RECEIVED)return"";var a="";for(var c in this.responseHeaders)this.responseHeaders.hasOwnProperty(c)&&!/^Set-Cookie2?$/i.test(c)&&(a+=c+": "+this.responseHeaders[c]+"\r\n");return a},setResponseBody:function(a){if(this.readyState==b.DONE)throw new Error("Request done");if(this.async&&this.readyState!=b.HEADERS_RECEIVED)throw new Error("No headers received");var c=this.chunkSize||10,d=0;this.responseText="";do this.async&&this.readyStateChange(b.LOADING),this.responseText+=a.substring(d,d+c),d+=c;while(d<a.length);var e=this.getResponseHeader("Content-Type");this.responseText&&(!e||/(text\/xml)|(application\/xml)|(\+xml)/.test(e))&&(this.responseXML=b.parseXML(this.responseText)),this.async?this.readyStateChange(b.DONE):this.readyState=b.DONE},respond:function(a,c,d){this.setResponseHeaders(c||{}),this.status=typeof a=="number"?a:200,this.statusText=b.statusCodes[this.status],this.setResponseBody(d||"")}}),sinon.extend(b,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4}),b.parseXML=function(a){var b;if(typeof DOMParser!="undefined"){var c=new DOMParser;b=c.parseFromString(a,"text/xml")}else b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},b.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"},b}(),function(a){var b=a.XMLHttpRequest,c=a.ActiveXObject,d=typeof ActiveXObject!="undefined",e=typeof XMLHttpRequest!="undefined";sinon.useFakeXMLHttpRequest=function(){return sinon.FakeXMLHttpRequest.restore=function f(f){e&&(a.XMLHttpRequest=b),d&&(a.ActiveXObject=c),delete sinon.FakeXMLHttpRequest.restore,f!==!0&&delete sinon.FakeXMLHttpRequest.onCreate},e&&(a.XMLHttpRequest=sinon.FakeXMLHttpRequest),d&&(a.ActiveXObject=function(a){return a=="Microsoft.XMLHTTP"||/^Msxml2\.XMLHTTP/.test(a)?new sinon.FakeXMLHttpRequest:new c(a)}),sinon.FakeXMLHttpRequest}}(this),typeof module=="object"&&typeof require=="function"&&(module.exports=sinon);if(typeof sinon=="undefined")var sinon={};sinon.fakeServer=function(){function a(){}function b(b){return a.prototype=b,new a}function c(a){var b=a;Object.prototype.toString.call(a)!="[object Array]"&&(b=[200,{},a]);if(typeof b[2]!="string")throw new TypeError("Fake server response body should be string, but was "+typeof b[2]);return b}function f(a,b,c){var d=a.method,e=!d||d.toLowerCase()==b.toLowerCase(),f=a.url,g=!f||f==c||typeof f.test=="function"&&f.test(c);return e&&g}function g(a,b){var c=this.getHTTPMethod(b),d=b.url;if(!/^https?:\/\//.test(d)||e.test(d))d=d.replace(e,"");return f(a,this.getHTTPMethod(b),d)?typeof a.response=="function"?a.response(b):!0:!1}var d=window.location,e=new RegExp("^"+d.protocol+"//"+d.host);return{create:function(){var a=b(this);return this.xhr=sinon.useFakeXMLHttpRequest(),a.requests=[],this.xhr.onCreate=function(b){a.addRequest(b)},a},addRequest:function(a){var b=this;this.requests.push(a),a.onSend=function(){b.handleRequest(this)},this.autoRespond&&!this.responding&&(setTimeout(function(){b.responding=!1,b.respond()},this.autoRespondAfter||10),this.responding=!0)},getHTTPMethod:function(a){if(this.fakeHTTPMethods&&/post/i.test(a.method)){var b=a.requestBody.match(/_method=([^\b;]+)/);return b?b[1]:a.method}return a.method},handleRequest:function(a){a.async?(this.queue||(this.queue=[]),this.queue.push(a)):this.processRequest(a)},respondWith:function(a,b,d){arguments.length==1?this.response=c(a):(this.responses||(this.responses=[]),arguments.length==2&&(d=b,b=a,a=null),this.responses.push({method:a,url:b,response:typeof d=="function"?d:c(d)}))},respond:function(){var a=this.queue||[],b;while(b=a.shift())this.processRequest(b)},processRequest:function(a){try{if(a.aborted)return;var b=this.response||[404,{},""];if(this.responses)for(var c=0,d=this.responses.length;c<d;c++)if(g.call(this,this.responses[c],a)){b=this.responses[c].response;break}a.readyState!=4&&a.respond(b[0],b[1],b[2])}catch(e){}},restore:function(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}(),typeof module=="object"&&typeof require=="function"&&(module.exports=sinon),function(){function a(){}a.prototype=sinon.fakeServer,sinon.fakeServerWithClock=new a,sinon.fakeServerWithClock.addRequest=function b(a){if(a.async){typeof setTimeout.clock=="object"?this.clock=setTimeout.clock:(this.clock=sinon.useFakeTimers(),this.resetClock=!0);if(!this.longestTimeout){var b=this.clock.setTimeout,c=this.clock.setInterval,d=this;this.clock.setTimeout=function(a,c){return d.longestTimeout=Math.max(c,d.longestTimeout||0),b.apply(this,arguments)},this.clock.setInterval=function(a,b){return d.longestTimeout=Math.max(b,d.longestTimeout||0),c.apply(this,arguments)}}}return sinon.fakeServer.addRequest.call(this,a)},sinon.fakeServerWithClock.respond=function(){var a=sinon.fakeServer.respond.apply(this,arguments);return this.clock&&(this.clock.tick(this.longestTimeout||0),this.longestTimeout=0,this.resetClock&&(this.clock.restore(),this.resetClock=!1)),a},sinon.fakeServerWithClock.restore=function(){return this.clock&&this.clock.restore(),sinon.fakeServer.restore.apply(this,arguments)}}();if(typeof require=="function"){var sinon=require("sinon");sinon.extend(sinon,require("./util/fake_timers"))}(function(){function a(a,b,c,d){if(!d)return;b.injectInto?b.injectInto[c]=d:a.args.push(d)}function b(a){var b=sinon.create(sinon.sandbox);return a.useFakeServer&&(typeof a.useFakeServer=="object"&&(b.serverPrototype=a.useFakeServer),b.useFakeServer()),a.useFakeTimers&&(typeof a.useFakeTimers=="object"?b.useFakeTimers.apply(b,a.useFakeTimers):b.useFakeTimers()),b}sinon.sandbox=sinon.extend(sinon.create(sinon.collection),{useFakeTimers:function(){return this.clock=sinon.useFakeTimers.apply(sinon,arguments),this.add(this.clock)},serverPrototype:sinon.fakeServer,useFakeServer:function(){var a=this.serverPrototype||sinon.fakeServer;return!a||!a.create?null:(this.server=a.create(),this.add(this.server))},inject:function(a){return sinon.collection.inject.call(this,a),this.clock&&(a.clock=this.clock),this.server&&(a.server=this.server,a.requests=this.server.requests),a},create:function(c){if(!c)return sinon.create(sinon.sandbox);var d=b(c);d.args=d.args||[];var e,f,g=d.inject({});if(c.properties)for(var h=0,i=c.properties.length;h<i;h++)e=c.properties[h],f=g[e]||e=="sandbox"&&d,a(d,c,e,f);else a(d,c,"sandbox",f);return d}}),sinon.sandbox.useFakeXMLHttpRequest=sinon.sandbox.useFakeServer,typeof module!="undefined"&&(module.exports=sinon.sandbox)})(),function(a){function c(b){var c=typeof b;if(c!="function")throw new TypeError("sinon.test needs to wrap a test function, got "+c);return function(){var c=a.getConfig(a.config);c.injectInto=c.injectIntoThis&&this||c.injectInto;var d=a.sandbox.create(c),e,f,g=Array.prototype.slice.call(arguments).concat(d.args);try{f=b.apply(this,g)}catch(h){e=h}d.verifyAndRestore();if(e)throw e;return f}}var b=typeof module=="object"&&typeof require=="function";!a&&b&&(a=require("sinon"));if(!a)return;c.config={injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0},b?module.exports=c:a.test=c}(typeof sinon=="object"&&sinon||null),function(a){function c(a,b,c){return function(){b&&b.apply(this,arguments);var d;try{a.apply(this,arguments)}catch(e){d=e}c&&c.apply(this,arguments);if(d)throw d}}function d(b,d){if(!b||typeof b!="object")throw new TypeError("sinon.testCase needs an object with test functions");d=d||"test";var e=new RegExp("^"+d),f={},g,h,i,j=b.setUp,k=b.tearDown;for(g in b)if(b.hasOwnProperty(g)){h=b[g];if(/^(setUp|tearDown)$/.test(g))continue;if(typeof h=="function"&&e.test(g)){i=h;if(j||k)i=c(h,j,k);f[g]=a.test(i)}else f[g]=b[g]}return f}var b=typeof module=="object"&&typeof require=="function";!a&&b&&(a=require("sinon"));if(!a||!Object.prototype.hasOwnProperty)return;b?module.exports=d:a.testCase=d}(typeof sinon=="object"&&sinon||null),function(a){function e(a){return a==1&&"once"||a==2&&"twice"||a==3&&"thrice"||(a||0)+" times"}function f(a){a||d.fail("fake is not a spy"),typeof a!="function"&&d.fail(a+" is not a function"),typeof a.getCall!="function"&&d.fail(a+" is not stubbed")}function g(a,b){var c=a.fail||d.fail;c.call(a,b)}function h(a,b){d[a]=function(h){f(h);var i=typeof h[a]=="function"?!h[a].apply(h,c.call(arguments,1)):!h[a];if(i){var j=b.replace("%c",e(h.callCount));j=j.replace("%n",h+""),j=j.replace("%*",[].slice.call(arguments,1).join(", "));for(var k=0,l=arguments.length;k<l;k++)j=j.replace("%"+k,arguments[k]);g(this,j)}else d.pass(a)}}var b=typeof module=="object"&&typeof require=="function",c=Array.prototype.slice,d;!a&&b&&(a=require("sinon"));if(!a)return;d={failException:"AssertError",fail:function(a){var b=new Error(a);throw b.name=this.failException||d.failException,b},pass:function(a){},called:function(a){f(a),a.called?d.pass("called"):g(this,"expected "+a+" to have been called at least once but was never called")},notCalled:function(a){f(a),a.called?g(this,"expected "+a+" to not have been called "+"but was called "+e(a.callCount)):d.pass("notCalled")},callOrder:function(){f(arguments[0]);var a=[],b=[],c=!1;a.push(arguments[0]);for(var e=1,h=arguments.length;e<h;e++)f(arguments[e]),a.push(arguments[e]),arguments[e-1].calledBefore(arguments[e])||(c=!0);if(c){b=[].concat(a).sort(function(a,b){var c=a.getCall(0).callId,d=b.getCall(0).callId;return c<d?-1:1});var i,j;try{i=a.join(", "),j=b.join(", ")}catch(k){}g(this,"expected "+(i||"")+" to be "+"called in order but were called as "+j)}else d.pass("callOrder")},callCount:function(a,b){f(a),a.callCount!=b?g(this,"expected "+a+" to be called "+e(b)+" but was called "+e(a.callCount)):d.pass("callCount")},expose:function(a,b){if(!a)throw new TypeError("target is null or undefined");b=b||{};var c=typeof b.prefix=="undefined"&&"assert"||b.prefix,d=function(a){return c?c+a.substring(0,1).toUpperCase()+a.substring(1):a};for(var e in this)/^(fail|expose)/.test(e)||(a[d(e)]=this[e]);if(typeof b.includeFail=="undefined"||!!b.includeFail)a.fail=this.fail,a.failException=this.failException;return a}},h("calledOnce","expected %n to be called once but was called %c"),h("calledTwice","expected %n to be called twice but was called %c"),h("calledThrice","expected %n to be called thrice but was called %c"),h("calledOn","expected %n to be called with %1 as this"),h("alwaysCalledOn","expected %n to always be called with %1 as this"),h("calledWith","expected %n to be called with arguments %*"),h("alwaysCalledWith","expected %n to always be called with arguments %*"),h("calledWithExactly","expected %n to be called with exact arguments %*"),h("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*"),h("threw","%n did not throw exception"),h("alwaysThrew","%n did not always throw exception"),b?module.exports=d:a.assert=d}(typeof sinon=="object"&&sinon||null)