/*!
 * Pusher JavaScript Library v1.6.4
 * http://pusherapp.com/
 *
 * Copyright 2010, New Bamboo
 * Released under the MIT licence.
 */
typeof Function.prototype.scopedTo=="undefined"&&(Function.prototype.scopedTo=function(a,b){var c=this;return function(){return c.apply(a,Array.prototype.slice.call(b||[]).concat(Array.prototype.slice.call(arguments)))}});var Pusher=function(a,b){this.path="/app/"+a+"?client=js&version="+Pusher.VERSION,this.key=a,this.channels=new Pusher.Channels,this.global_channel=new Pusher.Channel("pusher_global_channel"),this.global_channel.global=!0,this.connected=this.secure=!1,this.retry_counter=0,Pusher.isReady&&this.connect(),Pusher.instances.push(this),b&&this.subscribe(b),this.bind("pusher:connection_established",function(a){this.connected=!0,this.retry_counter=0,this.socket_id=a.socket_id,this.subscribeAll()}.scopedTo(this)),this.bind("pusher:connection_disconnected",function(){for(var a in this.channels.channels)this.channels.channels[a].disconnect()}.scopedTo(this)),this.bind("pusher:error",function(a){Pusher.log("Pusher : error : "+a.message)})};Pusher.instances=[],Pusher.prototype={channel:function(a){return this.channels.find(a)},connect:function(){var a="ws://"+Pusher.host+":"+Pusher.ws_port+this.path;this.secure==!0&&(a="wss://"+Pusher.host+":"+Pusher.wss_port+this.path),Pusher.allow_reconnect=!0,Pusher.log("Pusher : connecting : "+a);var b=this;window.WebSocket?(this.connection=new WebSocket(a),this.connection.onmessage=function(){b.onmessage.apply(b,arguments)},this.connection.onclose=function(){b.onclose.apply(b,arguments)},this.connection.onopen=function(){b.onopen.apply(b,arguments)}):(this.connection={},setTimeout(function(){b.send_local_event("pusher:connection_failed",{})},3e3))},toggle_secure:function(){this.secure==!1?(this.secure=!0,Pusher.log("Pusher: switching to wss:// connection")):(this.secure=!1,Pusher.log("Pusher: switching to ws:// connection"))},disconnect:function(){Pusher.log("Pusher : disconnecting"),Pusher.allow_reconnect=!1,Pusher.retry_count=0,this.connection.close()},bind:function(a,b){return this.global_channel.bind(a,b),this},bind_all:function(a){return this.global_channel.bind_all(a),this},subscribeAll:function(){for(var a in this.channels.channels)this.channels.channels.hasOwnProperty(a)&&this.subscribe(a)},subscribe:function(a){var b=this.channels.add(a);return this.connected&&b.authorize(this,function(b){this.send_event("pusher:subscribe",{channel:a,auth:b.auth,channel_data:b.channel_data})}.scopedTo(this)),b},unsubscribe:function(a){this.channels.remove(a),this.connected&&this.send_event("pusher:unsubscribe",{channel:a})},send_event:function(a,b){var c=JSON.stringify({event:a,data:b});return Pusher.log("Pusher : sending event : ",c),this.connection.send(c),this},send_local_event:function(a,b,c){b=Pusher.data_decorator(a,b);if(c){var d=this.channel(c);d&&d.dispatch_with_all(a,b)}this.global_channel.dispatch_with_all(a,b),Pusher.log("Pusher : event received : channel: "+c+"; event: "+a,b)},onmessage:function(a){a=Pusher.parser(a.data);if(!a.socket_id||a.socket_id!=this.socket_id){var b=a.event,c=Pusher.parser(a.data);this.send_local_event(b,c,a.channel)}},wait_and_reconnect:function(a,b){setTimeout(function(){a(),this.connect()}.scopedTo(this),b)},onclose:function(){var a=this;this.global_channel.dispatch("close",null),Pusher.log("Pusher: Socket closed");var b=5e3;this.connected==!0?(this.send_local_event("pusher:connection_disconnected",{}),Pusher.allow_reconnect&&(Pusher.log("Pusher : Reconnecting in 5 seconds..."),this.wait_and_reconnect(function(){},b))):(a.send_local_event("pusher:connection_failed",{}),this.retry_counter==0&&(b=100),this.retry_counter+=1,this.wait_and_reconnect(function(){a.toggle_secure()},b)),this.connected=!1},onopen:function(){this.global_channel.dispatch("open",null)}},Pusher.Util={extend:function(a,b){for(var c in b)a[c]=b[c];return a}},Pusher.VERSION="1.6.4",Pusher.host="ws.pusherapp.com",Pusher.ws_port=80,Pusher.wss_port=443,Pusher.channel_auth_endpoint="/pusher/auth",Pusher.log=function(){},Pusher.data_decorator=function(a,b){return b},Pusher.allow_reconnect=!0,Pusher.channel_auth_transport="ajax",Pusher.parser=function(a){try{return JSON.parse(a)}catch(b){return Pusher.log("Pusher : data attribute not valid JSON - you may wish to implement your own Pusher.parser"),a}},Pusher.isReady=!1,Pusher.ready=function(){Pusher.isReady=!0;for(var a=0;a<Pusher.instances.length;a++)Pusher.instances[a].connected||Pusher.instances[a].connect()},Pusher.Channels=function(){this.channels={}},Pusher.Channels.prototype={add:function(a){var b=this.find(a);return b?b:(b=Pusher.Channel.factory(a),this.channels[a]=b)},find:function(a){return this.channels[a]},remove:function(a){delete this.channels[a]}},Pusher.Channel=function(a){this.name=a,this.callbacks={},this.global_callbacks=[],this.subscribed=!1},Pusher.Channel.prototype={init:function(){},disconnect:function(){},acknowledge_subscription:function(){this.subscribed=!0},bind:function(a,b){return this.callbacks[a]=this.callbacks[a]||[],this.callbacks[a].push(b),this},bind_all:function(a){return this.global_callbacks.push(a),this},dispatch_with_all:function(a,b){this.dispatch(a,b),this.dispatch_global_callbacks(a,b)},dispatch:function(a,b){var c=this.callbacks[a];if(c)for(var d=0;d<c.length;d++)c[d](b);else this.global||Pusher.log("Pusher : No callbacks for "+a)},dispatch_global_callbacks:function(a,b){for(var c=0;c<this.global_callbacks.length;c++)this.global_callbacks[c](a,b)},is_private:function(){return!1},is_presence:function(){return!1},authorize:function(a,b){b({})}},Pusher.auth_callbacks={},Pusher.authorizers={ajax:function(a,b){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.open("POST",Pusher.channel_auth_endpoint,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){if(c.readyState==4)if(c.status==200){var a=Pusher.parser(c.responseText);b(a)}else Pusher.log("Couldn't get auth info from your webapp"+status)},c.send("socket_id="+encodeURIComponent(a.socket_id)+"&channel_name="+encodeURIComponent(this.name))},jsonp:function(a,b){var c="socket_id="+encodeURIComponent(a.socket_id)+"&channel_name="+encodeURIComponent(this.name),d=document.createElement("script");Pusher.auth_callbacks[this.name]=b,d.src=Pusher.channel_auth_endpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+this.name+"']")+"&"+c,c=document.getElementsByTagName("head")[0]||document.documentElement,c.insertBefore(d,c.firstChild)}},Pusher.Channel.PrivateChannel={is_private:function(){return!0},authorize:function(a,b){Pusher.authorizers[Pusher.channel_auth_transport].scopedTo(this)(a,b)}},Pusher.Channel.PresenceChannel={init:function(){this.bind("pusher_internal:subscription_succeeded",function(a){this.acknowledge_subscription(a),this.dispatch_with_all("pusher:subscription_succeeded",this.members())}.scopedTo(this)),this.bind("pusher_internal:member_added",function(a){this.track_member(a,1);if(this.member_exists(a))return!1;this.add_member(a),this.dispatch_with_all("pusher:member_added",a)}.scopedTo(this)),this.bind("pusher_internal:member_removed",function(a){this.track_member(a,-1);if(this._members_count[a.user_id]>0)return!1;this.remove_member(a),this.dispatch_with_all("pusher:member_removed",a)}.scopedTo(this))},disconnect:function(){this._members_map={},this._members_count={}},acknowledge_subscription:function(a){this._members_map={},this._members_count={};for(var b=0;b<a.length;b++)this._members_map[a[b].user_id]=a[b],this.track_member(a[b],1);this.subscribed=!0},track_member:function(a,b){return this._members_count[a.user_id]=this._members_count[a.user_id]||0,this._members_count[a.user_id]+=b,this},member_exists:function(a){return typeof this._members_map[a.user_id]!="undefined"},is_presence:function(){return!0},members:function(){var a=[],b;for(b in this._members_map)a.push(this._members_map[b]);return a},add_member:function(a){this._members_map[a.user_id]=a},remove_member:function(a){delete this._members_map[a.user_id]}},Pusher.Channel.factory=function(a){var b=new Pusher.Channel(a);return a.indexOf(Pusher.Channel.private_prefix)===0?Pusher.Util.extend(b,Pusher.Channel.PrivateChannel):a.indexOf(Pusher.Channel.presence_prefix)===0&&(Pusher.Util.extend(b,Pusher.Channel.PrivateChannel),Pusher.Util.extend(b,Pusher.Channel.PresenceChannel)),b.init(),b},Pusher.Channel.private_prefix="private-",Pusher.Channel.presence_prefix="presence-",WEB_SOCKET_SWF_LOCATION="http://js.pusherapp.com/1.6.4/WebSocketMain.swf";var _require=function(){var a;return a=document.addEventListener?function(a,b){a.addEventListener("load",b,!1)}:function(a,b){a.attachEvent("onreadystatechange",function(){a.readyState=="loaded"&&b()})},function(b,c){function d(b,c){c=c||function(){};var d=document.getElementsByTagName("head")[0],g=document.createElement("script");g.setAttribute("src",b+".js"),g.setAttribute("type","text/javascript"),g.setAttribute("async",!0),a(g,function(){var a=c;e++,f==e&&setTimeout(a,0)}),d.appendChild(g)}for(var e=0,f=b.length,g=0;g<f;g++)d(b[g],c)}}();(function(){var a=[],b=function(){Pusher.ready()};window.JSON==undefined&&a.push("http://js.pusherapp.com/1.6.4/json2"),window.WebSocket==undefined&&(window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,a.push("http://js.pusherapp.com/1.6.4/flashfallback"),b=function(){FABridge.addInitializationCallback("webSocket",function(){Pusher.ready()}),WebSocket.__initialize()}),a.length>0?_require(a,b):b()})()